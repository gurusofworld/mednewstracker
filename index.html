<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Medical Research Radar — v2.2 (Safe Dates + Self‑Tests)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body{ font-family:'Inter', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial; }
    .card{ background:linear-gradient(180deg,#ffffff,#f8fbff); }
    .shadow-smooth{ box-shadow:0 10px 28px rgba(2,6,23,.06), 0 2px 8px rgba(2,6,23,.06); }
    .line-clamp-4{ display:-webkit-box; -webkit-line-clamp:4; -webkit-box-orient:vertical; overflow:hidden; }
    .pill{ padding:.25rem .7rem; border-radius:9999px; font-size:.75rem; font-weight:600; border:1px solid rgb(203 213 225); background:rgba(255,255,255,.75); }
    .hero{ background: radial-gradient(60% 90% at 20% 10%, rgba(14,165,233,.12), transparent), radial-gradient(60% 80% at 80% 0%, rgba(8,145,178,.12), transparent), linear-gradient(180deg,#ecfeff,#ffffff); }
  </style>
</head>
<body class="min-h-screen hero text-slate-800">
  <header class="sticky top-0 z-40 backdrop-blur bg-white/80 border-b border-slate-200">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <h1 class="text-2xl font-extrabold text-cyan-700">Medical Research Radar</h1>
      <div class="flex gap-2">
        <button id="refreshBtn" class="px-3 py-2 text-sm rounded-lg bg-cyan-600 text-white">Refresh</button>
        <button id="runTestsBtn" class="px-3 py-2 text-sm rounded-lg border border-slate-300 bg-white">Run self‑tests</button>
      </div>
    </div>
    <div class="max-w-7xl mx-auto px-4 pb-3 grid sm:grid-cols-12 gap-3">
      <div class="sm:col-span-8 flex gap-2">
        <input id="searchInput" placeholder="Search topics, journals, tags…" class="w-full px-4 py-2 rounded-lg border border-slate-300 bg-white" />
        <button id="clearSearch" class="px-3 py-2 rounded-lg border">Clear</button>
      </div>
      <div class="sm:col-span-4 flex gap-2">
        <select id="sourceSelect" class="w-1/2 px-2 py-2 rounded-lg border"><option value="">All sources</option></select>
        <select id="tagSelect" class="w-1/2 px-2 py-2 rounded-lg border"><option value="">All specialties</option></select>
      </div>
    </div>
    <div id="tagCloud" class="max-w-7xl mx-auto px-4 pb-2 flex flex-wrap gap-2"></div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-6">
    <div id="status" class="text-sm text-slate-600"></div>
    <div id="tests" class="hidden mt-3 p-4 rounded-xl border border-slate-200 bg-white text-sm"></div>
    <div id="cards" class="mt-4 grid sm:grid-cols-2 lg:grid-cols-3 gap-5"></div>
  </main>

  <footer class="border-t py-6 text-center text-sm text-slate-500">
    <p>Sources include NEJM, JAMA, BMJ, Lancet, Nature, PLOS; Indian sources (IJMR, ICMR, MoHFW); trusted news (Medscape, STAT, WHO, CDC). Edit FEEDS below to add more specialties.</p>
  </footer>

  <script>
    // ====================== FETCH STRATEGY ======================
    // Use a JSON service first (rss2json), then fall back to raw XML via CORS proxies.
    const JSON_API = (rssUrl)=>`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`;
    const RAW_PROXIES = [
      (url)=>`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
      (url)=>`https://cors.isomorphic-git.org/${encodeURIComponent(url)}`
    ];

    const CACHE_KEY = 'medradar_v2_2';
    const CACHE_MIN = 5; // minutes

    // ====================== FEEDS ======================
    const FEEDS = [
      // General / Flagship
      { name:'NEJM', url:'https://www.nejm.org/action/showFeed?type=etoc&feed=rss&jc=nejm', tags:['General Medicine'] },
      { name:'The Lancet', url:'https://www.thelancet.com/rssfeed/lancet_current.xml', tags:['General Medicine'] },
      { name:'JAMA', url:'https://jamanetwork.com/rss/site_9/0.xml', tags:['General Medicine'] },
      { name:'BMJ', url:'https://www.bmj.com/rss/bmj_latest.xml', tags:['General Medicine'] },
      { name:'Nature Medicine', url:'https://www.nature.com/nm.rss', tags:['Translational','General Medicine'] },
      { name:'PLOS Medicine', url:'https://journals.plos.org/plosmedicine/feed/atom', tags:['General Medicine','Global Health'] },
      { name:'Annals of Internal Medicine', url:'https://www.acpjournals.org/action/showFeed?type=etoc&feed=rss&jc=aim', tags:['Internal Medicine'] },

      // Specialty slices (add more anytime)
      { name:'Circulation', url:'https://www.ahajournals.org/action/showFeed?type=etoc&feed=rss&jc=circulationaha', tags:['Cardiology'] },
      { name:'European Heart Journal', url:'https://academic.oup.com/eurheartj/advance-article-xml/ehj.xml', tags:['Cardiology'] },
      { name:'JACC', url:'https://www.jacc.org/rss/site_16/0.xml', tags:['Cardiology'] },
      { name:'Lancet Oncology', url:'https://www.thelancet.com/rssfeed/lanonc_current.xml', tags:['Oncology'] },
      { name:'Journal of Clinical Oncology', url:'https://ascopubs.org/action/showFeed?type=etoc&feed=rss&jc=jco', tags:['Oncology'] },
      { name:'Blood', url:'https://ashpublications.org/rss/site_8/0.xml', tags:['Hematology'] },
      { name:'Lancet Infectious Diseases', url:'https://www.thelancet.com/rssfeed/lancetinfdis_current.xml', tags:['Infectious Disease'] },
      { name:'Neurology (AAN)', url:'https://www.neurology.org/rss/current.xml', tags:['Neurology'] },
      { name:'Lancet Psychiatry', url:'https://www.thelancet.com/rssfeed/lanpsy_current.xml', tags:['Psychiatry'] },
      { name:'Lancet Diabetes & Endocrinology', url:'https://www.thelancet.com/rssfeed/landia_current.xml', tags:['Endocrinology'] },
      { name:'Gastroenterology', url:'https://www.gastrojournal.org/current.rss', tags:['Gastroenterology'] },
      { name:'Kidney International', url:'https://www.kidney-international.org/current.rss', tags:['Nephrology'] },
      { name:'CJASN', url:'https://cjasn.asnjournals.org/rss/current.xml', tags:['Nephrology'] },
      { name:'Annals of Surgery', url:'https://journals.lww.com/annalsofsurgery/_layouts/15/oaks.journals/rss.aspx?issue=Current+Issue', tags:['Surgery'] },
      { name:'Bone & Joint Journal', url:'https://online.boneandjoint.org.uk/rss/site_8/0.xml', tags:['Orthopedics'] },
      { name:'Anesthesiology', url:'https://journals.lww.com/anesthesiology/_layouts/15/oaks.journals/rss.aspx?issue=Current+Issue', tags:['Anesthesiology'] },
      { name:'Radiology', url:'https://pubs.rsna.org/action/showFeed?type=etoc&feed=rss&jc=radiology', tags:['Radiology'] },

      // News & public health
      { name:'WHO News', url:'https://www.who.int/rss-feeds/news-english.xml', tags:['Public Health'] },
      { name:'CDC Newsroom', url:'https://tools.cdc.gov/api/v2/resources/media/403372.rss', tags:['Public Health'] },
      { name:'Medscape', url:'https://www.medscape.com/rss', tags:['Medical News'] },
      { name:'STAT News', url:'https://www.statnews.com/feed/', tags:['Medical News'] },

      // India
      { name:'Indian J Med Res (IJMR)', url:'https://ijmr.icmr.org.in/currentissue/rss', tags:['General Medicine','India'] },
      { name:'ICMR', url:'https://main.icmr.nic.in/rss.xml', tags:['Public Health','India'] },
      { name:'MoHFW India', url:'https://main.mohfw.gov.in/rss.xml', tags:['Public Health','India'] }
      // Note: AIIMS site lists feeds on an HTML page; if you have a direct RSS URL, add it here.
    ];

    const TAG_COLORS = {
      'Cardiology':'bg-rose-100 text-rose-700 border-rose-200',
      'Oncology':'bg-fuchsia-100 text-fuchsia-700 border-fuchsia-200',
      'Hematology':'bg-red-100 text-red-700 border-red-200',
      'Infectious Disease':'bg-amber-100 text-amber-800 border-amber-200',
      'Neurology':'bg-sky-100 text-sky-800 border-sky-200',
      'Psychiatry':'bg-violet-100 text-violet-800 border-violet-200',
      'Endocrinology':'bg-orange-100 text-orange-800 border-orange-200',
      'Pulmonology':'bg-blue-100 text-blue-800 border-blue-200',
      'Gastroenterology':'bg-lime-100 text-lime-800 border-lime-200',
      'Nephrology':'bg-emerald-100 text-emerald-800 border-emerald-200',
      'Dermatology':'bg-pink-100 text-pink-800 border-pink-200',
      'Obstetrics & Gynecology':'bg-rose-100 text-rose-800 border-rose-200',
      'Urology':'bg-yellow-100 text-yellow-800 border-yellow-200',
      'Pediatrics':'bg-emerald-100 text-emerald-800 border-emerald-200',
      'Geriatrics':'bg-stone-100 text-stone-800 border-stone-200',
      'Emergency Medicine':'bg-indigo-100 text-indigo-800 border-indigo-200',
      'Critical Care':'bg-cyan-100 text-cyan-800 border-cyan-200',
      'Anesthesiology':'bg-teal-100 text-teal-800 border-teal-200',
      'Radiology':'bg-cyan-100 text-cyan-800 border-cyan-200',
      'Pathology':'bg-slate-100 text-slate-800 border-slate-200',
      'Ophthalmology':'bg-teal-100 text-teal-800 border-teal-200',
      'Rheumatology':'bg-purple-100 text-purple-800 border-purple-200',
      'Orthopedics':'bg-amber-100 text-amber-800 border-amber-200',
      'Surgery':'bg-slate-100 text-slate-800 border-slate-300',
      'Family Medicine':'bg-gray-100 text-gray-800 border-gray-300',
      'ENT':'bg-blue-100 text-blue-800 border-blue-200',
      'Dentistry':'bg-green-100 text-green-800 border-green-200',
      'General Medicine':'bg-gray-100 text-gray-800 border-gray-300',
      'Internal Medicine':'bg-gray-100 text-gray-800 border-gray-300',
      'Medical News':'bg-pink-100 text-pink-800 border-pink-200',
      'Public Health':'bg-green-100 text-green-800 border-green-200',
      'Global Health':'bg-green-100 text-green-800 border-green-200',
      'India':'bg-orange-50 text-orange-800 border-orange-200',
      'Translational':'bg-indigo-100 text-indigo-800 border-indigo-200'
    };

    // ====================== STATE ======================
    const state = { all:[], filtered:[], query:'', tag:'', source:'', page:1 };

    // ====================== HELPERS (robust date handling) ======================
    function parseDateToTs(raw){
      if(!raw) return null;
      if(raw instanceof Date){ const t = raw.getTime(); return Number.isFinite(t)? t : null; }
      if(typeof raw === 'number'){ return Number.isFinite(raw)? raw : null; }
      if(typeof raw !== 'string') return null;
      const s = raw.trim();
      // Try native
      let d = new Date(s);
      if(Number.isFinite(d.getTime())) return d.getTime();
      // Common tweaks
      d = new Date(s.replace('GMT','UTC'));
      if(Number.isFinite(d.getTime())) return d.getTime();
      // If looks like 'YYYY-MM-DD HH:MM:SS', treat as UTC
      if(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}(:\d{2})?$/.test(s)){
        d = new Date(s.replace(' ', 'T')+'Z');
        if(Number.isFinite(d.getTime())) return d.getTime();
      }
      // If only date 'YYYY-MM-DD'
      if(/^\d{4}-\d{2}-\d{2}$/.test(s)){
        d = new Date(s+'T00:00:00Z');
        if(Number.isFinite(d.getTime())) return d.getTime();
      }
      return null;
    }

    function fmtDateSafe(ts){
      if(!Number.isFinite(ts)) return 'Date unknown';
      try{ return new Intl.DateTimeFormat('en-IN',{ dateStyle:'medium', timeStyle:'short', timeZone:'Asia/Kolkata'}).format(new Date(ts)); }
      catch{ return 'Date unknown'; }
    }

    function sanitizeHTML(html){ const tmp=document.createElement('div'); tmp.innerHTML=html||''; tmp.querySelectorAll('script,style').forEach(e=>e.remove()); return (tmp.textContent||'').replace(/\s+/g,' ').trim(); }
    function faviconFor(url){ try{ const host=new URL(url).hostname; return `https://icons.duckduckgo.com/ip3/${host}.ico`; }catch{ return ''; } }
    function primaryCategory(tags){ return (tags && tags.length)? tags[0] : 'General Medicine'; }
    function makeTagPills(tags){ return (tags||[]).map(t=>`<span class="pill ${(TAG_COLORS[t]||'bg-slate-100 text-slate-800 border-slate-300')}">${t}</span>`).join(''); }
    function whatsappShareText(item){ const t = `${item.title}\n\n${item.highlights? item.highlights+"\n\n":''}${item.link}`; return `https://api.whatsapp.com/send?text=${encodeURIComponent(t)}`; }

    // ====================== UI HELPERS ======================
    function setStatus(t){ document.getElementById('status').textContent=t; }
    function buildFilters(){
      const sources=[...new Set(FEEDS.map(f=>f.name))].sort();
      const tags=[...new Set(FEEDS.flatMap(f=>f.tags||[]))].sort();
      document.getElementById('sourceSelect').innerHTML = '<option value="">All sources</option>' + sources.map(s=>`<option value="${s}">${s}</option>`).join('');
      document.getElementById('tagSelect').innerHTML = '<option value="">All specialties</option>' + tags.map(t=>`<option value="${t}">${t}</option>`).join('');
      document.getElementById('tagCloud').innerHTML = ['Cardiology','Oncology','Infectious Disease','Surgery','Orthopedics','Neurology','Psychiatry','Pediatrics','Radiology','Endocrinology','Gastroenterology','Nephrology','Dermatology','Obstetrics & Gynecology','Urology','Emergency Medicine','Critical Care','Ophthalmology','Rheumatology','Family Medicine','Public Health','India']
        .filter(t=>tags.includes(t))
        .map(t=>`<button class="pill ${(TAG_COLORS[t]||'bg-slate-100 border-slate-300')} hover:opacity-90" onclick="state.tag='${t}'; applyFilters();">${t}</button>`)
        .join('');
    }

    function applyFilters(){
      let rows=[...state.all];
      const q=state.query.trim().toLowerCase();
      if(q){ rows=rows.filter(r=> (r.title||'').toLowerCase().includes(q) || (r.highlights||'').toLowerCase().includes(q) || (r.source||'').toLowerCase().includes(q) || (r.tags||[]).join(' ').toLowerCase().includes(q)); }
      if(state.tag){ rows=rows.filter(r=> (r.tags||[]).includes(state.tag)); }
      if(state.source){ rows=rows.filter(r=> r.source===state.source); }
      state.filtered = rows;
      render();
    }

    function render(){
      const cards=document.getElementById('cards');
      if(!state.filtered.length){
        cards.innerHTML = `<div class="p-6 rounded-2xl border border-amber-300 bg-amber-50 text-amber-900">
          <div class="font-semibold">No items yet.</div>
          <ul class="mt-2 text-sm list-disc pl-5 space-y-1">
            <li>Click <strong>Refresh</strong> to retry (cache resets after ${CACHE_MIN} min).</li>
            <li>Some journals block public proxies; a tiny backend proxy (Cloudflare Worker) will make 100% load.</li>
          </ul>
        </div>`;
        return;
      }
      cards.innerHTML = state.filtered.map(item=>{
        const cat = primaryCategory(item.tags);
        const siteIcon = faviconFor(item.link);
        return `
          <article class="card p-4 rounded-2xl border shadow-smooth hover:shadow-lg transition">
            <div class="flex items-start gap-3">
              <img src="${siteIcon}" alt="icon" class="w-5 h-5 mt-1 rounded" onerror="this.style.display='none'"/>
              <div class="flex-1">
                <div class="text-xs text-slate-500">${item.source}</div>
                <a href="${item.link}" target="_blank" rel="noopener" class="mt-1 block text-base font-semibold leading-tight text-cyan-700 hover:underline">${item.title}</a>
                <p class="mt-2 text-sm text-slate-700 line-clamp-4">${item.highlights||''}</p>
                <div class="mt-3 flex flex-wrap gap-2 items-center">
                  ${makeTagPills(item.tags)}
                  <span class="pill bg-white text-slate-600 border-slate-300">${fmtDateSafe(item.ts)}</span>
                  <span class="pill bg-white text-slate-600 border-slate-300">Category: <strong class="ml-1">${cat}</strong></span>
                  <a href="${whatsappShareText(item)}" target="_blank" class="ml-auto px-2 py-1 text-xs rounded-md border border-emerald-300 bg-emerald-50 text-emerald-700 hover:bg-emerald-100">Share</a>
                </div>
              </div>
            </div>
          </article>`;
      }).join('');
    }

    // ====================== FETCHERS ======================
    async function fetchViaProxies(url){
      for(const p of RAW_PROXIES){
        try{ const r=await fetch(p(url),{cache:'no-store'}); if(!r.ok) throw new Error('HTTP '+r.status); const t=await r.text(); if(t && t.length>40) return t; }catch(e){ /* try next */ }
      }
      throw new Error('All raw proxies failed for '+url);
    }

    async function fetchFeedJSON(feed){
      const r = await fetch(JSON_API(feed.url), { cache:'no-store' });
      if(!r.ok) throw new Error('rss2json HTTP '+r.status);
      const j = await r.json();
      if(!j || !j.items) throw new Error('rss2json no items');
      return j.items.map(it=>{
        const ts = parseDateToTs(it.pubDate || it.pubdate || it.date || it.updated);
        return {
          source: feed.name,
          title: it.title || '(untitled)',
          link: it.link || it.guid || feed.url,
          highlights: sanitizeHTML(it.description || it.content || '' ).slice(0, 320),
          ts, // numeric timestamp or null
          tags: feed.tags || []
        };
      });
    }

    function getAtomLink(node){
      const links = Array.from(node.getElementsByTagName('link'));
      const alt = links.find(l=> (l.getAttribute('rel')||'').toLowerCase()==='alternate' && l.getAttribute('href'));
      return (alt && alt.getAttribute('href')) || (links[0]?.getAttribute('href')) || (links[0]?.textContent) || '';
    }

    async function fetchFeedXML(feed){
      const txt = await fetchViaProxies(feed.url);
      const xml = new DOMParser().parseFromString(txt, 'text/xml');
      let items = Array.from(xml.getElementsByTagName('item'));
      const isAtom = !items.length && xml.getElementsByTagName('entry').length>0;
      if(isAtom){ items = Array.from(xml.getElementsByTagName('entry')); }
      return items.slice(0, 30).map(node=>{
        const title = (node.getElementsByTagName('title')[0]?.textContent || '').trim() || '(untitled)';
        const link = isAtom ? getAtomLink(node) : ((node.getElementsByTagName('link')[0]?.textContent || node.getElementsByTagName('link')[0]?.getAttribute('href') || '').trim());
        const desc = (node.getElementsByTagName('description')[0]?.textContent || node.getElementsByTagName('summary')[0]?.textContent || node.getElementsByTagName('content')[0]?.textContent || '').trim();
        const highlights = sanitizeHTML(desc).slice(0, 320);
        const rawDate = (node.getElementsByTagName('pubDate')[0]?.textContent || node.getElementsByTagName('published')[0]?.textContent || node.getElementsByTagName('updated')[0]?.textContent || '').trim();
        const ts = parseDateToTs(rawDate);
        return { source:feed.name, title, link: link || feed.url, highlights, ts, tags: feed.tags || [] };
      });
    }

    async function fetchFeed(feed){
      try{ return await fetchFeedJSON(feed); }catch(e){ console.warn('rss2json failed', feed.name, e.message||e); }
      try{ return await fetchFeedXML(feed); }catch(e){ console.warn('XML fetch failed', feed.name, e.message||e); }
      return [];
    }

    async function loadAll(){
      setStatus('Loading…');
      buildFilters();
      // Cache
      const t = Number(localStorage.getItem(CACHE_KEY+':t')||0);
      if(Date.now()-t < CACHE_MIN*60*1000){
        try{ const cached = JSON.parse(localStorage.getItem(CACHE_KEY)||'[]'); if(Array.isArray(cached) && cached.length){ state.all=cached; state.all.sort(sortByTsDesc); state.filtered=[...state.all]; render(); setStatus(`${state.all.length} items (cache) • Updated ${fmtDateSafe(Date.now())}`); return; } }catch{}
      }

      // Fetch in parallel
      const results = [];
      await Promise.allSettled(FEEDS.map(async f=>{ try{ const rows=await fetchFeed(f); results.push(...rows); }catch(e){ console.warn('Feed failed', f.name, e); } }));

      // Sort: recent first; null dates go to the bottom
      results.sort(sortByTsDesc);
      state.all = results;
      state.filtered = [...results];
      localStorage.setItem(CACHE_KEY, JSON.stringify(results));
      localStorage.setItem(CACHE_KEY+':t', String(Date.now()));

      render();
      setStatus(`${results.length} items • Updated ${fmtDateSafe(Date.now())}`);
    }

    function sortByTsDesc(a,b){
      const ta = Number.isFinite(a.ts)? a.ts : -Infinity; // undefined -> bottom
      const tb = Number.isFinite(b.ts)? b.ts : -Infinity;
      return tb - ta;
    }

    // ====================== EVENTS ======================
    document.getElementById('searchInput').addEventListener('input', e=>{ state.query=e.target.value||''; applyFilters(); });
    document.getElementById('clearSearch').addEventListener('click', ()=>{ state.query=''; document.getElementById('searchInput').value=''; applyFilters(); });
    document.getElementById('tagSelect').addEventListener('change', e=>{ state.tag=e.target.value||''; applyFilters(); });
    document.getElementById('sourceSelect').addEventListener('change', e=>{ state.source=e.target.value||''; applyFilters(); });
    document.getElementById('refreshBtn').addEventListener('click', ()=>{ localStorage.removeItem(CACHE_KEY); localStorage.removeItem(CACHE_KEY+':t'); loadAll(); });
    document.getElementById('runTestsBtn').addEventListener('click', runSelfTests);

    // ====================== SELF‑TESTS (unit tests for date parsing) ======================
    function runSelfTests(){
      const panel=document.getElementById('tests'); panel.classList.remove('hidden'); panel.innerHTML='Running tests…';
      const cases = [
        { s:'Tue, 20 Aug 2024 12:34:56 GMT', ok:true },
        { s:'2025-08-20T12:34:56Z', ok:true },
        { s:'Wed, 20 Aug 2025 12:34:56 +0000', ok:true },
        { s:'2025-08-20 12:34:56', ok:true },
        { s:'2025-08-20', ok:true },
        { s:'', ok:false },
        { s:undefined, ok:false },
        { s:'not a date', ok:false }
      ];
      const results = [];
      for(const c of cases){
        let ts=null, passed=false, err='';
        try{ ts = parseDateToTs(c.s); passed = (!!ts) === c.ok; }catch(e){ passed = !c.ok; err = e.message||String(e); }
        // Also ensure fmtDateSafe never throws
        try{ fmtDateSafe(ts); }catch(e){ passed=false; err = 'fmt threw'; }
        results.push({input:c.s, expected:c.ok, got:!!ts, passed, err});
      }
      const allPass = results.every(r=>r.passed);
      panel.innerHTML = `<div class="font-semibold ${allPass?'text-emerald-700':'text-rose-700'}">Self‑tests ${allPass?'passed ✅':'had failures ❌'}</div>
        <table class="mt-3 w-full text-xs">
          <thead><tr class="text-left"><th class="py-1 pr-2">Input</th><th class="py-1 pr-2">Expected</th><th class="py-1 pr-2">Got</th><th class="py-1 pr-2">Pass</th><th class="py-1 pr-2">Notes</th></tr></thead>
          <tbody>
            ${results.map(r=>`<tr class="border-t"><td class="py-1 pr-2 whitespace-pre">${String(r.input)}</td><td class="py-1 pr-2">${r.expected}</td><td class="py-1 pr-2">${r.got}</td><td class="py-1 pr-2">${r.passed?'✅':'❌'}</td><td class="py-1 pr-2">${r.err||''}</td></tr>`).join('')}
          </tbody>
        </table>`;
    }

    // ====================== START ======================
    loadAll();
  </script>
</body>
</html>
